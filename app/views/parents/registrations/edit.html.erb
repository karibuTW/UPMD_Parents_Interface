<div class="flex flex-wrap">
  <%= render 'parents/shared/sidebar', title: '.edit_profile' %>

  <div class="w-full md:w-1/2 p-5">

    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), class: "w-full max-w-lg",
                 data: { controller: 'nested-form', nested_form_wrapper_selector_value: '.nested-form-wrapper' }, method: :put) do |f| %>
      <div class="flex flex-wrap  mb-6">
        <div class="w-full px-3 ">
          <div class="field">
            <% invalid = resource.errors.include?(:email) %>
            <%= f.label :email, class: "form-label" %><br />
            <%= f.email_field :email, autofocus: true, autocomplete: "email",
                              class: "form-input #{invalid ? 'invalid' : 'valid'}", placeholder: "example@example.com",
                              required: true %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:email).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap mb-6">
        <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
          <div class="field">
            <% invalid = resource.errors.include?(:first_name) %>
            <%= f.label :first_name, class: "form-label" %><br />
            <%= f.text_field :first_name, autocomplete: "first_name",
                             class: "form-input #{invalid ? 'invalid' : 'valid'}", placeholder: "John",
                             required: true %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:first_name).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>

        <div class="w-full md:w-1/2 px-3">
          <div class="field">
            <% invalid = resource.errors.include?(:last_name) %>
            <%= f.label :last_name, class: "form-label" %><br />
            <%= f.text_field :last_name, autocomplete: "last_name",
                             class: "form-input #{invalid ? 'invalid' : 'valid'}", placeholder: "Doe",
                             required: true %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:last_name).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap mb-6">
        <div class="w-full px-3 ">
          <div class="field">
            <% invalid = resource.errors.include?(:full_name) %>
            <%= f.label :full_name, class: "form-label" %><br />
            <%= f.text_field :full_name, autocomplete: "name",
                             class: "form-input #{invalid ? 'invalid' : 'valid'}", placeholder: "John Doe",
                             required: true %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:full_name).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap mb-6">
        <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
          <div class="field">
            <% invalid = resource.errors.include?(:password) %>
            <%= f.label :password, "Password (#{t('.leave_blank_if_you_don_t_want_to_change_it')})", class: "form-label" %>
            <% if @minimum_password_length %>
              <em class="form-label">(<%=  t('devise.shared.minimum_password_length', count: @minimum_password_length) %>)</em>
            <% end %>
            <%= f.password_field :password, autocomplete: "new-password",
                                 class: "form-input #{invalid ? 'invalid' : 'valid'}", placeholder: "******" %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:password).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>

        <div class="w-full md:w-1/2 px-3">
          <div class="field">
            <% invalid = resource.errors.include?(:password_confirmation) %>
            <%= f.label :password_confirmation, class: "form-label" %><br />
            <%= f.password_field :password_confirmation, autocomplete: "new-password",
                                 class: "form-input #{invalid ? 'invalid' : 'valid'}", placeholder: "******" %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:password_confirmation).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap mb-6">
        <div class="w-full px-3 ">
          <div class="field">
            <% invalid = resource.errors.include?(:address) %>
            <%= f.label :address, class: "form-label" %><br />
            <%= f.text_area :address, autocomplete: "address",
                            class: "form-input #{invalid ? 'invalid' : 'valid'}", placeholder: Faker::Address.full_address %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:address).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
      <div class="flex flex-wrap mb-6">
        <div class="w-full px-3">
          <div class="field">
            <% invalid = resource.errors.include?(:nationalities) %>
            <%= f.label :nationalities, t("activerecord.attributes.parent.nationality"), class: "form-label" %>
            <%= f.select :nationalities, nations_map, {},
                         class: "form-input #{invalid ? 'invalid' : 'valid'}", multiple: true,
                         data: { controller: 'slimselect' } %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:nationalities).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
      <div class="flex flex-wrap mb-6">
        <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
          <div class="field">
            <% invalid = resource.errors.include?(:phone_number) %>
            <%= f.label :phone_number, t("phone_no_with_country_code"), class: "form-label" %>
            <%= f.phone_field :phone_number, autocomplete: "phone_number",
                              class: "form-input #{invalid ? 'invalid' : 'valid'}", placeholder: "+84627899541",
                              required: true %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:phone_number).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>

        <div class="w-full md:w-1/2 px-3">
          <div class="field">
            <% invalid = resource.errors.include?(:preferred_language) %>
            <%= f.label :preferred_language, class: "form-label" %>
            <%= f.select :preferred_language, locale_map(Parent.preferred_languages.keys.to_a), { prompt: "Select one" },
                         class: "form-input #{invalid ? 'invalid' : 'valid'}",
                         required: true %>
            <% if invalid %>
              <% resource.errors.full_messages_for(:preferred_language).each do |error_message| %>
                <p class="text-red-500 text-xs italic"><%= error_message %></p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
      <div class="flex flex-wrap mb-6">
        <div class="field">
          <%= f.label :mailing_list, t("join_mailing_list"), class: "mx-3 uppercase font-bold" %>
          <%= f.check_box :mailing_list %>

        </div>
      </div>

      <div class="flex flex-wrap mb-6">
        <div class="field">
          <%= f.label :bus_registration, t("avail_bus_service", year_start: Setting.current_school_year_start,
                                           year_end: Setting.current_school_year_end), class: "mx-3 uppercase font-bold" %>
          <%#= check_box_tag :bus_registration, current_parent.has_current_bus_registration?,  current_parent.has_current_bus_registration? %>
          <%= f.label :bus_registration, t('y') %>
          <%= radio_button_tag :bus_registration, 'yes', true %>
          <%= f.label :bus_registration, t('n') %>
          <%= radio_button_tag :bus_registration, 'no' %>
        </div>
      </div>

      <div class="p-3">
        <h2 class="text-xl mb-5"><%= t("optional_secondary_parent") %></h2>
      </div>
      <%= f.fields_for :secondary_parent, second_parent(resource) do |p_field| %>
        <%= render "parents/registrations/secondary", f: p_field, show_destroy: true %>
      <% end %>
      <template data-nested-form-target="template">
        <%= f.fields_for :children, Child.new, child_index: 'NEW_RECORD' do |child_fields| %>
          <%= render "parents/registrations/child_form", f: child_fields %>
        <% end %>
      </template>

      <div class="p-3">
        <h2 class="text-xl mb-5"><%= t("information_about_children") %></h2>
        <%= f.fields_for :children do |child_field| %>
          <%= render "parents/registrations/child_form", f: child_field %>
        <% end %>

        <!-- Inserted elements will be injected before that target. -->
        <div data-nested-form-target="target"></div>

        <button type="button" data-action="nested-form#add" class="form-button">
          <%= t("add_child") %>
        </button>
      </div>

      <hr />

      <div class="p-3">
        <div class="field">
          <% invalid = resource.errors.include?(:current_password) %>
          <%= f.label :current_password, class: "form-label" %> <i>(<%= t('.we_need_your_current_password_to_confirm_your_changes') %>)</i><br />
          <%= f.password_field :current_password, autocomplete: "current-password",class: "form-input #{invalid ? 'invalid' : 'valid'}", placeholder: "******", required: true %>
          <% if invalid %>
            <% resource.errors.full_messages_for(:current_password).each do |error_message| %>
              <p class="text-red-500 text-xs italic"><%= error_message %></p>
            <% end %>
          <% end %>
        </div>
      </div>


      <div class="actions w-full my-5 mx-3">
        <%= f.submit t('.update'), class: "form-button" %>
      </div>
      <div class="p-3 text-blue">
        <%= render "parents/shared/links" %>
      </div>
    <% end %>



  </div>

</div>
